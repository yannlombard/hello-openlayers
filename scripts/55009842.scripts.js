"use strict";var app=angular.module("carto",["ngCookies","ngResource","ngSanitize","ngRoute","ui.sortable"]);app.config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),app.controller("MainCtrl",["$scope",function(a){a.baseLayers=[{type:"wms",url:"http://vmap0.tiles.osgeo.org/wms/vmap0",title:"WMS Ground",params:{LAYERS:"ground_01",VISIBLE:!0,OPACITY:1},options:{isBaseLayer:!0}}],a.layers=[{type:"wms",url:"http://vmap0.tiles.osgeo.org/wms/vmap0",title:"WMS Coastline",params:{LAYERS:"coastline_01",VISIBLE:!0,OPACITY:.5},options:{isBaseLayer:!1}}],a.baseLayers2=angular.copy(a.baseLayers),a.layers2=angular.copy(a.layers),a.$watch("map",function(){})}]),app.controller("module1Ctrl",["$scope","$timeout",function(a,b){a.layer={type:"wms",url:"http://mesonet.agron.iastate.edu/cgi-bin/wms/nexrad/n0r.cgi",title:"Nexrad",params:{LAYERS:"nexrad-n0r",TRANSPARENT:!0,OPACITY:.5,FORMAT:"image/png"},options:{isBaseLayer:!1}},a.customLayers=[],a.addLayer=function(b){var c=angular.copy(a.layer);a.customLayers.push(c),b.push(c)},a.removeLayer=function(b,c){var d=a.customLayers[c];b.pop(d),a.customLayers.pop(d)},b(function(){a.map1isReady()},1e3)}]),app.directive("sglkCarto",["$q",function(){return{restrict:"A",templateUrl:"views/carto.html",transclude:!0,replace:!0,scope:{map:"=ngModel",ready:"="},controller:["$scope",function(a){a.showMap=!!a.showMap;var b,c=this;b=new OpenLayers.Map,a.layers=[],a.baseLayers=[],this.addLayer=function(d,e){e?a.baseLayers.push(d):a.layers.push(d),b.addLayer(d.object);var f=d.ngModel.params;f.opacity=angular.isUndefined(f.opacity)?1:f.opacity,f.visible=angular.isUndefined(f.visible)?!0:f.visible,angular.isUndefined(d.ngModel.zindex)&&(d.ngModel.zindex=b.getLayerIndex(d.object)),c.updateLayer(d)},this.removeLayer=function(c,d){var e=function(a,b){var c=a.indexOf(b);return a.splice(c,1),a};d?a.baseLayers=e(a.baseLayers,c):a.layers=e(a.layers,c),b.removeLayer(c.object)},this.updateLayer=function(a){var c=a.ngModel;a.object.setOpacity(c.params.opacity),a.object.setVisibility(c.params.visible),b.setLayerIndex(a.object,c.zindex),c.options.isBaseLayer&&b.setCenter(new OpenLayers.LonLat(-50,40),3)},a.map=b}],link:function(a,b,c){a.render=function(){a.showMap=!0,a.map.render(b.find(".mapWrapper")[0])},angular.isUndefined(c.ready)?a.render():a.ready=function(){a.render()},a.sortableOptions={axis:"y",update:function(){},stop:function(){angular.forEach(a.layers,function(a,b){a.ngModel.zindex=b}),a.$digest()}},a.hasModules=!!b.find("[sglk-aside-item]").length}}}]).directive("sglkLayer",function(){return{require:"^sglkCarto",restrict:"A",scope:{ngModel:"="},link:function(a,b,c,d){var e=a.ngModel;switch(e.type){default:a.object=new OpenLayers.Layer.WMS(e.title,e.url,e.params,e.options)}d.addLayer(a,angular.isDefined(c.isBaseLayer)),a.$watch("ngModel",function(){d.updateLayer(a)},!0),a.$on("$destroy",function(){d.removeLayer(a,angular.isDefined(c.isBaseLayer))})}}}),app.directive("sglkAside",function(){return{templateUrl:"views/sglk-aside.html",transclude:!0,restrict:"A",replace:!0,scope:{ngModel:"="},controller:["$scope",function(a){a.panes=[],a.ngModel={all:a.panes,active:""},this.addPane=function(b){a.panes.push(b)},this.togglePane=function(b){b.active?(b.active=!1,a.ngModel.active=""):(angular.forEach(a.panes,function(a){a.active=!1}),b.active=!0,a.ngModel.active=b.id)}}]}}).directive("sglkAsideItem",function(){return{require:"^sglkAside",templateUrl:"views/sglk-aside-item.html",transclude:!0,restrict:"A",replace:!0,scope:{picto:"@",id:"@"},link:function(a,b,c,d){d.addPane(a),a.toggle=function(){d.togglePane(a)}}}}),app.controller("easementCtrl",["$scope",function(a){var b=new OpenLayers.Layer.Vector;a.test=function(){a.map.addLayer(b);var c=new OpenLayers.Control.DrawFeature(b,OpenLayers.Handler.Polygon);a.map.addControl(c),c.activate()},b.events.on({beforefeatureadded:function(b){var c=new OpenLayers.Layer.Vector("Polygon"),d=new OpenLayers.Feature.Vector(b.feature.geometry);c.addFeatures(d),a.map.addLayer(c);var e=new OpenLayers.Format.WKT,f=e.write(d);return a.$apply(function(){a.geometryString=f}),!1}})}]);